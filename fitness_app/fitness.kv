#:kivy 2.3.0

<Label>:
    color: 1, 1, 1, 1
    font_size: 18

<TextInput>:
    background_color: 0.12, 0.12, 0.12, 1
    foreground_color: 1, 1, 1, 1
    padding: 10
    font_size: 16
    size_hint_y: None
    height: 42
    cursor_color: 0, 1, 0.4, 1

<Button>:
    background_normal: ""
    background_color: 0, 0.78, 0.32, 1
    color: 1, 1, 1, 1
    font_size: 16
    size_hint_y: None
    height: 48
    canvas.before:
        Color:
            rgba: self.background_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [10,]
        Color:
            rgba: 0, 0, 0, 0.15
        RoundedRectangle:
            pos: self.x, self.y - 2
            size: self.size
            radius: [10,]

<GradientBackground>:
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            size: self.size
            texture: self.gradient_texture
    gradient_texture: self.create_gradient_texture()
    on_size: self.gradient_texture = self.create_gradient_texture()

<LoginScreen>:
    FloatLayout:
        GradientBackground:
            size: root.size
            pos: root.pos

        BoxLayout:
            orientation: "vertical"
            size_hint: 0.4, 0.6
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            padding: 30
            spacing: 15
            canvas.before:
                Color:
                    rgba: 0, 0, 0, 0.4
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [20,]

            Label:
                text: "üèãÔ∏è‚Äç‚ôÇÔ∏è Fitness Tracker"
                font_size: 28
                bold: True

            TextInput:
                id: username
                hint_text: "U≈æivatelsk√© jm√©no"

            TextInput:
                id: password
                hint_text: "Heslo"
                password: True

            Button:
                text: "P≈ôihl√°sit se"
                on_release: root.login()


<MainScreen>:
    BoxLayout:
        spacing: 0
        
        # Navigation Sidebar
        BoxLayout:
            orientation: "vertical"
            size_hint_x: 0.2
            padding: 20
            spacing: 15
            canvas.before:
                Color:
                    rgba: 0.12, 0.12, 0.12, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            Label:
                text: "üèãÔ∏è‚Äç‚ôÇÔ∏è Fitness"
                font_size: 24
                bold: True
                size_hint_y: None
                height: 40

            Label:
                text: root.username
                font_size: 18
                size_hint_y: None
                height: 30

            Widget:
                size_hint_y: 0.1

            Button:
                text: "üéØ Tr√©ninky"
                background_color: (0, 0.78, 0.32, 1) if root.current_view == "workouts" else (0.2, 0.2, 0.2, 1)
                on_release: root.switch_view("workouts")

            Button:
                text: "üìä Statistiky"
                background_color: (0, 0.78, 0.32, 1) if root.current_view == "stats" else (0.2, 0.2, 0.2, 1)
                on_release: root.switch_view("stats")

            Widget:
                size_hint_y: 1

            Button:
                text: "‚¨ÖÔ∏è Odhl√°sit se"
                background_color: 1, 0.25, 0.25, 1
                on_release: root.logout()

        # Main Content Area
        BoxLayout:
            padding: 20

            # Workouts View
            BoxLayout:
                orientation: "vertical"
                opacity: 1 if root.current_view == "workouts" else 0
                disabled: root.current_view != "workouts"

                WorkoutsScreen:
                    id: workouts_screen

            # Stats View
            BoxLayout:
                orientation: "vertical"
                opacity: 1 if root.current_view == "stats" else 0
                disabled: root.current_view != "stats"

                StatsScreen:
                    id: stats_screen


<WorkoutsScreen>:
    BoxLayout:
        orientation: "horizontal"
        spacing: 0
        padding: 0

        # Main content area (left). When panel opens this shrinks to 70%.
        BoxLayout:
            id: main_area
            orientation: "vertical"
            spacing: 20
            padding: 30
            size_hint_x: 0.7 if root.show_exercises else 1

            BoxLayout:
                orientation: "vertical"
                spacing: 20
                size_hint_y: None
                height: self.minimum_height

                Button:
                    text: "üìã Vybrat cvik" if not root.selected_exercise else root.selected_exercise
                    size_hint_y: None
                    height: 48
                    on_release: root.toggle_exercise_list()

                BoxLayout:
                    spacing: 15
                    size_hint_y: None
                    height: 48
                    TextInput:
                        id: sets
                        hint_text: "S√©rie"
                        input_filter: "int"
                    TextInput:
                        id: reps
                        hint_text: "Opakov√°n√≠"
                        input_filter: "int"
                    TextInput:
                        id: weight
                        hint_text: "V√°ha (kg)"
                        input_filter: "int"

            Button:
                text: "‚úÖ P≈ôidat do tr√©ninku"
                size_hint_y: None
                height: 48
                on_release: root.add_exercise()

            BoxLayout:
                spacing: 10
                size_hint_y: None
                height: 48

                Button:
                    text: "üíæ Ulo≈æit tr√©nink"
                    on_release: root.save_workout()

                Button:
                    text: "üóëÔ∏è Smazat posledn√≠"
                    background_color: 0.8, 0.2, 0.2, 1
                    on_release: root.remove_last()

            ScrollView:
                TextInput:
                    id: workout_list
                    size_hint: 1, None
                    height: max(self.minimum_height, 200)
                    readonly: True
                    multiline: True

            TextInput:
                id: note
                hint_text: "Pozn√°mka k tr√©ninku (voliteln√©)"
                size_hint_y: None
                height: 80
                multiline: True

        # Right-side exercise panel. When hidden it collapses to 0 width and won't cover the main area.
        BoxLayout:
            id: exercise_panel
            orientation: "vertical"
            size_hint_x: 0.3 if root.show_exercises else 0
            padding: [10, 20, 10, 20]
            spacing: 10
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [10, 0, 0, 10]
            opacity: 1 if root.show_exercises else 0
            disabled: not root.show_exercises

            Label:
                text: "Seznam cvik≈Ø"
                font_size: 20
                size_hint_y: None
                height: 30
                bold: True

            ScrollView:
                do_scroll_x: False
                BoxLayout:
                    id: exercise_list
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 5

            BoxLayout:
                orientation: "horizontal"
                size_hint_y: None
                height: 48
                spacing: 8
                TextInput:
                    id: new_exercise
                    hint_text: "Nov√Ω cvik"
                    size_hint_x: 0.7
                    input_filter: None
                Button:
                    text: "‚ûï"
                    size_hint_x: 0.3
                    on_release: root.add_custom_exercise()


<StatsScreen>:
    BoxLayout:
        orientation: "vertical"
        padding: 40
        spacing: 20

        # Sekce v√°hy
        BoxLayout:
            size_hint_y: None
            height: 48
            spacing: 10
            Label:
                id: weight_label
                text: "Aktu√°ln√≠ v√°ha: " + str(root.user_weight) + " kg" if root.user_weight else "Zadej svoji v√°hu:"
            TextInput:
                id: weight_input
                hint_text: "V√°ha (kg)"
                input_filter: "int"
                size_hint_x: 0.3
            Button:
                text: "‚úì Ulo≈æit"
                size_hint_x: 0.3
                on_release: root.update_weight()

        # Progress & Records
        TabbedPanel:
            do_default_tab: False
            
            TabbedPanelItem:
                text: "Osobn√≠ rekordy"
                BoxLayout:
                    orientation: "vertical"
                    padding: 20
                    ScrollView:
                        Label:
                            id: pr_label
                            text: ""
                            font_size: 18
                            text_size: self.size
                            size_hint_y: None
                            height: self.texture_size[1]
                            halign: "center"
                            valign: "top"
            
            TabbedPanelItem:
                text: "Progress"
                BoxLayout:
                    orientation: "vertical"
                    padding: 20
                    spacing: 5
                    ScrollView:
                        Label:
                            id: progress_label
                            text: ""
                            font_size: 18
                            text_size: self.size
                            size_hint_y: None
                            height: self.texture_size[1]
                            halign: "left"
                            valign: "top"

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: 48
            spacing: 8
            TextInput:
                id: new_exercise
                hint_text: "Nov√Ω cvik"
                size_hint_x: 0.7
                input_filter: None
            Button:
                text: "‚ûï"
                size_hint_x: 0.3
                on_release: root.add_custom_exercise()